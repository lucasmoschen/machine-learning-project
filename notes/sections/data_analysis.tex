\section{Exploratory data analysis}
\label{sec:eda}

\subsection{Data description}

\BL{T}he dataset used in this study was extracted from the project MonitorAr-Rio
\cite{dataset-rio-ar-quality}. The table contains hourly data observations, separated by
pollutant, weather condition, and monitoring stations' characteristics from
the city of Rio de Janeiro. Table
\ref{tab:measured-data} informs the most important variables used, and Table
\ref{tab:pollutants-measured} indicates the measured pollutants per monitoring
station. The events were collected between January 1,
2011,
and March 31, 2021. A total of 661,662 records were used.

We count the missing values for each of the main variables used in this work
and present them in Table \ref{tab:missing-values}. We observe that some
meterological variables have more than 10\% of missing values, what is a lot.
The CO gas has more missing values than the other gases, because Pedra de
Guaratiba does not measure it. If we disconsider this kind of absent values,
CO has around 6\%. Imputation methods to handle this problem in Section
\ref{sec:data-preprocessing}.

It is also noticed that almost 91\% of the values in ``Chuva'' column and 26\%
of ``RS'' column are zero. If we consider the accumulated monthly amount of
rain, the value seems to make sense and it is comparable to other sources,
therefore we kept it. 

We did not observe any pattern of missing values per year or per monitoring
station. In 2012, over half of the wind information is missing, however other
features are stable. However, after 2016, UR dominates the number of absent
data. If we aggregate by time (hour, day, month, and year), and sum up the
values of the features of each station, we do not observe missing values. This
imply we can use information of other stations to impute data whenever
necessary. 

\begin{table*}[t]
    \centering
    \begin{tabular}{c|c|c|c|}
        \cline{2-4}
       & \textbf{Name} & \textbf{Type} & \textbf{Description}              \\ \hline
        \multicolumn{1}{|c|}{\multirow{7}{*}{\textbf{Meterological conditions}}} & Chuva         & float         & Rainfall (mm)                     \\ \cline{2-4} 
        \multicolumn{1}{|c|}{}                                                   & Pres          & float         & Atmospheric Pressure (mbar)       \\ \cline{2-4} 
        \multicolumn{1}{|c|}{}                                                   & RS            & float         & Solar radiation (w/m2)            \\ \cline{2-4} 
        \multicolumn{1}{|c|}{}                                                   & Temp          & float         & Temperature (°C)                  \\ \cline{2-4} 
        \multicolumn{1}{|c|}{}                                                   & UR            & float         & Relative humidity (\%)            \\ \cline{2-4} 
        \multicolumn{1}{|c|}{}                                                   & Dir\_Vento    & float         & Wind direction (°)                \\ \cline{2-4} 
        \multicolumn{1}{|c|}{}                                                   & Vel\_Vento    & float         & Wind speed (m/s)                  \\ \hline
        \multicolumn{1}{|c|}{\multirow{5}{*}{\textbf{Measurement conditions}}}   & Data          & datetime      & Measurement date and hour         \\ \cline{2-4} 
        \multicolumn{1}{|c|}{}                                                   & CodNum        & ineger        & Number of the monitoring station  \\ \cline{2-4} 
        \multicolumn{1}{|c|}{}                                                   & Estação       & string        & Name of the monitoring station    \\ \cline{2-4} 
        \multicolumn{1}{|c|}{}                                                   & Lat           & float         & Latitude position of the station  \\ \cline{2-4} 
        \multicolumn{1}{|c|}{}                                                   & Lon           & float         & Longitude position of the station \\ \hline
        \end{tabular}
    \caption{Measured parameters by the program MonitorAr.}
    \label{tab:measured-data}
\end{table*}

\begin{table*}[t]
    \centering
    \begin{tabular}{|c|c|}
    \hline
    \textbf{Monitoring station}        & \textbf{Measured gases/particulates}              \\ \hline
    Centro (CA)             & O$_3$, CO, PM$_{10}$                              \\ \hline
    Copacabana (AV)         & SO$_2$, O$_3$, CO, PM$_{10}$                      \\ \hline
    São Cristóvão (SC)      & SO$_2$, O$_3$, CO, PM$_{10}$                      \\ \hline
    Tijuca (SP)             & SO$_2$, NOx, O$_3$, CO, PM$_{10}$                 \\ \hline
    Irajá (IR)              & SO$_2$, NOx, O$_3$, CO, HC, PM$_{2.5}$, PM$_{10}$ \\ \hline
    Bangu (BG)              & SO$_2$, NOx, O$_3$, CO, HC, PM$_{10}$             \\ \hline
    Campo Grande (CG)       & SO$_2$, NOx, O$_3$, CO, HC, PM$_{10}$             \\ \hline
    Pedra de Guaratiba (PG) & O$_3$, PM$_{10}$                                  \\ \hline
    \end{tabular}
    \caption{Pollutant data measured by each monitoring station. CO and HC are measured in (ppm), while the others are measured in (µg/m3).}
    \label{tab:pollutants-measured}
\end{table*}

\begin{table}
    \centering
    \begin{tabular}{|c|c|}
        \hline
        {\bf Variable} & {\bf Missing values} \\\hline
        Data      &        0 (0.0 \%) \\\hline
        CodNum    &        0 (0.0 \%) \\\hline
        Lat       &        0 (0.0 \%) \\\hline
        Lon       &        0 (0.0 \%) \\\hline
        Chuva     &   15812 (2.38 \%) \\\hline
        Pres      &   15294 (2.31 \%) \\\hline
        RS        &   48260 (7.29 \%) \\\hline
        Temp      &   70617 (10.6 \%) \\\hline
        UR        &  110619 (16.7 \%) \\\hline
        Dir\_Vento &   90498 (13.6 \%) \\\hline
        Vel\_Vento &   90743 (13.7 \%) \\\hline
        CO        &  114179 (17.2 \%) \\\hline
        O3        &   37133 (5.61 \%) \\\hline
        PM10      &   36142 (5.46 \%) \\\hline
    \end{tabular}
    \caption{Missing data in absolute and proportional values of the main variables.}
    \label{tab:missing-values}    
\end{table}

\begin{enumerate}
    \item Gráficos dos gases e interpretação de alguns deles. Analisar curtose
    e assimetria.
    \item Mensurações temporais de alguns gases. Selecionar alguns poucos
    \item Testes de estacionariedade nas séries utilizadas. 
    \item Mais alguns gráficos de visualização. 
\end{enumerate}

\subsection{Data preprocessing}
\label{sec:data-preprocessing}

The data preprocessing is an important step before the usage of machine
learning algorithms, in order to report robust and neat results. 

\begin{enumerate}
    \item Imputation of missing data
    \item Handling outliers
    \item normalization and standardization. 
    \item feature engineering
\end{enumerate}

\subsubsection{Missing data imputation}

In this dataset, there is two types of missing data: (1) monitoring stations
do not measure all pollutants by construction. For instance, it is not
measured NOx in Centro and Copacabana; and (2) monitoring stations did not
measure in a period for some reason. We have to deal with them in two
different ways. 

\begin{enumerate}
    \item Possíveis formas de imputação: estimação polinomial de 2ª ordem.
    Alguns testes simples pode ser interessante. Para locais onde não há
    estimação, não faz sentido imputar. 
\end{enumerate}

\subsubsection{Data transformation}

\begin{enumerate}
    \item Transformação Yeo-Johnson 
\end{enumerate}

\subsubsection{Feature extraction}

From the variable {\tt Data}, we can observe (Figure
\ref{fig:histogram-obs-years}) that 2011 has less observations, because there
were only four of the eight stations operating. For that reason, we do not
consider the data from this year. 

\begin{figure}
    \begin{center}
        \includegraphics[width=0.47\textwidth]{histogram.eps}
    \end{center}
    \caption{Number of hourly measurements per year. In 2011, only half of the monitoring stations worked.}
    \label{fig:histogram-obs-years}
\end{figure}

\begin{enumerate}
    \item Analisar sazonalidade. Adicionar termo seno e cosseno de forma que
    exista sazonalidade diária, isto é, 
    $$
    \text{hour\_sin} = \sin(2\pi \text{ hour}/24)
    $$
    \item Create variable season. 
    \item Visualize the series autocorrelation in order to define the number
    of lag variables per pollutant and particle.
    \item Complete the dataset with temporal variables.     
    \item The number of features is XXX: lag features, roll mean features,
    weekend, season, trigonometric  
\end{enumerate}

\subsubsection{Feature selection}

In order to reduce the dimensionality of the feature space, from the XXX
variables described, variable selection was performed. Filters are methods
which perform feature selection, as well as embedding methods, although they
depend on the machine learning algorithm chosen. 

\begin{enumerate}
    \item Pearson correlation-based filter to feature selection. Observe
    correlation of the lag variables. 
\end{enumerate}

The objective of this work is generate different forecasting models for the
pollutants A, B, C, and D. The maintained features in the dataset can be seen
in Table XXX.

\com{We applied PCA in order to reduce the dimensionality.}

